"use strict";function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,r){if(a){if("string"==typeof a)return _arrayLikeToArray(a,r);var t=Object.prototype.toString.call(a).slice(8,-1);return"Object"===t&&a.constructor&&(t=a.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(a,r):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,r){(null==r||r>a.length)&&(r=a.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=a[t];return n}var buttons=document.getElementById("buttons"),result=document.getElementById("result-answer"),list=document.getElementById("history-list"),btnClear=document.getElementById("clearButton"),btnBack=document.getElementById("backButton"),addition=function(a,r){return a+r},substraction=function(a,r){return a-r},multiplication=function(a,r){return a*r},division=function(a,r){if(0!==r)return a/r;alert("Division by zero")};function showHistory(a){a+="="+arrayCalculation[0];var r=document.createElement("li"),t=document.createTextNode(a);r.append(t),list.append(r)}function calculateResult(){var a=arrayCalculation.filter((function(a){return""!==a&&null!==a}));function r(){var r,t=-1;return a.forEach((function(a,r){"("===a&&(t=r)})),r=a.indexOf(")",t),{begin:t,end:r}}function t(a){var r=a.indexOf("*"),t=a.indexOf("/"),n=a.indexOf("+"),e=a.indexOf("-");return-1!==r&&-1!==t&&r<t?r:-1!==r&&-1!==t&&t<r?t:-1!==r?r:-1!==t?t:-1!==n&&-1!==e&&n<e?n:-1!==n&&-1!==e&&e<n?e:-1!==n?n:-1!==e?e:null}function n(a,r){if(null!==r){var t,n=a.slice(r-1,r+2);try{t=function(a){var r,t=+a[0],n=a[1],e=+a[2];switch(n){case"+":r=addition(t,e);break;case"-":r=substraction(t,e);break;case"*":r=multiplication(t,e);break;case"/":r=division(t,e);break;default:console.log("Неизвенствый операнд",n)}return r.toString()}(n)}catch(a){return!1}return a.splice(r-1,3,t),a}console.log(a)}for(var e=!1;1!==a.length&&!0!==e;){var l=r();if(-1!==l.begin&&-1!==l.end){var i=Math.abs(l.begin-l.end)<=2?a.slice(l.begin+1,l.end):a.slice(l.begin,l.end+1);if(1!==i.length){var o,u=n(i,t(i));!1!==u?(o=a).splice.apply(o,[l.begin,Math.abs(l.begin-l.end-1)].concat(_toConsumableArray(u))):e=!0}else a.splice(l.begin,1),a.splice(l.end-1,1)}else{var c=t(a),s=n(a,c);!1!==s?a=s:e=!0}}(arrayCalculation=[])[0]=a}var arrayCalculation=[];function calculation(a){var r=a.target.textContent,t=arrayCalculation.length-1>=0?arrayCalculation.length-1:0,n=""===arrayCalculation[t]?arrayCalculation[t-1]:arrayCalculation[t];function e(){arrayCalculation[t]+=r}function l(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;arrayCalculation.push(a),arrayCalculation.push("")}switch(void 0===n&&(n=""),r){case".":""===arrayCalculation[t]&&(r="0."),arrayCalculation[t].includes(".")||e();break;case"=":calculateResult(),showHistory(result.innerText);break;case"()":var i=arrayCalculation.filter((function(a){return"("===a})).length,o=arrayCalculation.filter((function(a){return")"===a})).length;"("===r&&i++,")"===r&&o++,")"===n&&o===i?(arrayCalculation.push("*"),r="("):n.match(/[0-9]/)&&i>o||")"===n?r=")":n.match(/[0-9]/)?(arrayCalculation.push("*"),r="("):r="(",l();break;case"+/-":var u=arrayCalculation[t];(u.match(/[0-9]/)||{}).input&&(u=-u,arrayCalculation[t]=u.toString());break;case(r.match(/[\+\-\/\*]/)||{}).input:if(t>0){var c=(n.match(/[\+\-\/\*]$/)||{}).input;c?arrayCalculation[t-1]=r:c||0===t||"("===n||l()}else l();break;case(r.match(/[0-9]/)||{}).input:")"===n&&(arrayCalculation[t]="*",t++,arrayCalculation.push("")),e();break;default:console.log("Неожиданный символ",r)}result.innerText=arrayCalculation.join("")}function clear(){(arrayCalculation=[])[0]="",result.innerText="",document.querySelectorAll("li").forEach((function(a){return list.removeChild(a)}))}function back(){var a=arrayCalculation[arrayCalculation.length-1].split("");1===a.length?arrayCalculation.pop():a.length>1&&(arrayCalculation.pop(),a.pop(),arrayCalculation.push(a.join(""))),result.innerText=arrayCalculation.join("")}arrayCalculation[0]="",buttons.addEventListener("mousedown",calculation),btnClear.addEventListener("mousedown",clear),btnBack.addEventListener("mousedown",back);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJfdG9Db25zdW1hYmxlQXJyYXkiLCJhcnIiLCJfYXJyYXlXaXRob3V0SG9sZXMiLCJfaXRlcmFibGVUb0FycmF5IiwiX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5IiwiX25vbkl0ZXJhYmxlU3ByZWFkIiwiVHlwZUVycm9yIiwibyIsIm1pbkxlbiIsIl9hcnJheUxpa2VUb0FycmF5IiwibiIsIk9iamVjdCIsInByb3RvdHlwZSIsInRvU3RyaW5nIiwiY2FsbCIsInNsaWNlIiwiY29uc3RydWN0b3IiLCJuYW1lIiwiQXJyYXkiLCJmcm9tIiwidGVzdCIsIml0ZXIiLCJTeW1ib2wiLCJpdGVyYXRvciIsImlzQXJyYXkiLCJsZW4iLCJsZW5ndGgiLCJpIiwiYXJyMiIsImJ1dHRvbnMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwicmVzdWx0IiwibGlzdCIsImJ0bkNsZWFyIiwiYnRuQmFjayIsImFkZGl0aW9uIiwieCIsInkiLCJzdWJzdHJhY3Rpb24iLCJtdWx0aXBsaWNhdGlvbiIsImRpdmlzaW9uIiwiYWxlcnQiLCJzaG93SGlzdG9yeSIsImhpc3RvckNhbGMiLCJhcnJheUNhbGN1bGF0aW9uIiwiZWxlbUhpcyIsImNyZWF0ZUVsZW1lbnQiLCJ0ZXh0IiwiY3JlYXRlVGV4dE5vZGUiLCJhcHBlbmQiLCJjYWxjdWxhdGVSZXN1bHQiLCJmaWx0ZXIiLCJpdGVtIiwiZmluZEJyYWtldHMiLCJpbmRleEVuZCIsImluZGV4QmVnaW4iLCJmb3JFYWNoIiwiaW5kZXgiLCJpbmRleE9mIiwiYmVnaW4iLCJlbmQiLCJmaW5kT3BlcmFuZCIsImFyckNhbGMiLCJtdWx0IiwiZGl2IiwiYWRkIiwic3ViIiwiY2hhbmdlQ2FsY0FycmF5IiwiY2FsY0FycmF5Iiwib3BlcmFuZCIsIm5ld051bSIsIm5ld0FyciIsImZpcnN0TnVtIiwic2Vjb25kTnVtIiwiY29uc29sZSIsImxvZyIsImNhbGN1bGF0aW9uIiwiX3VudXNlZCIsInNwbGljZSIsImV4aXQiLCJicmFrZXRzIiwiTWF0aCIsImFicyIsIl9hcnIiLCJuZXdBcnJheSIsImFwcGx5IiwiY29uY2F0IiwiZXZlbnQiLCJlbGVtZW50IiwidGFyZ2V0IiwidGV4dENvbnRlbnQiLCJub3dJbmRleCIsInByZXZFbGVtZW50IiwiYWRkRWxlbWVudCIsIm5ld0VsZW1lbnQiLCJhcmd1bWVudHMiLCJ1bmRlZmluZWQiLCJwdXNoIiwiaW5jbHVkZXMiLCJpbm5lclRleHQiLCJjb3VudExlZnRCcmFrZXRzIiwiY291bnRSaWd0aEJyYWtldHMiLCJtYXRjaCIsIm5vd0VsZW1lbnQiLCJpbnB1dCIsImlzT3BlcmFuZCIsImpvaW4iLCJjbGVhciIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJyZW1vdmVDaGlsZCIsImJhY2siLCJsYXN0Iiwic3BsaXQiLCJwb3AiLCJhZGRFdmVudExpc3RlbmVyIl0sIm1hcHBpbmdzIjoiQUFBQSxhQUVBLFNBQVNBLG1CQUFtQkMsR0FBTyxPQUFPQyxtQkFBbUJELElBQVFFLGlCQUFpQkYsSUFBUUcsNEJBQTRCSCxJQUFRSSxxQkFFbEksU0FBU0EscUJBQXVCLE1BQU0sSUFBSUMsVUFBVSx3SUFFcEQsU0FBU0YsNEJBQTRCRyxFQUFHQyxHQUFVLEdBQUtELEVBQUwsQ0FBZ0IsR0FBaUIsaUJBQU5BLEVBQWdCLE9BQU9FLGtCQUFrQkYsRUFBR0MsR0FBUyxJQUFJRSxFQUFJQyxPQUFPQyxVQUFVQyxTQUFTQyxLQUFLUCxHQUFHUSxNQUFNLEdBQUksR0FBaUUsTUFBbkQsV0FBTkwsR0FBa0JILEVBQUVTLGNBQWFOLEVBQUlILEVBQUVTLFlBQVlDLE1BQWdCLFFBQU5QLEdBQXFCLFFBQU5BLEVBQW9CUSxNQUFNQyxLQUFLVCxHQUFjLGNBQU5BLEdBQXFCLDJDQUEyQ1UsS0FBS1YsR0FBV0Qsa0JBQWtCRixFQUFHQyxRQUF6RyxHQUU3UyxTQUFTTCxpQkFBaUJrQixHQUFRLEdBQXNCLG9CQUFYQyxRQUEwQkEsT0FBT0MsWUFBWVosT0FBT1UsR0FBTyxPQUFPSCxNQUFN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SUFBSWMsR0FBYWIsRUFBWVUsTUFBTSxnQkFBa0IsSUFBSUUsTUFDckRDLEVBQ0E3RCxpQkFBaUIrQyxFQUFXLEdBQUtILEVBQ3pCaUIsR0FBMEIsSUFBYmQsR0FBa0MsTUFBaEJDLEdBQ3ZDRSxTQUdKQSxJQUVKLE1BRUosS0FBTU4sRUFBUWMsTUFBTSxVQUFZLElBQUlFLE1BQ1osTUFBaEJaLElBQ0FoRCxpQkFBaUIrQyxHQUFZLElBQzdCQSxJQUNBL0MsaUJBQWlCcUQsS0FBSyxLQUUxQkosSUFDQSxNQUVKLFFBQ0luQixRQUFRQyxJQUFJLHFCQUFzQmEsR0FJMUN6RCxPQUFPb0UsVUFBWXZELGlCQUFpQjhELEtBQUssSUFHN0MsU0FBU0MsU0FDTC9ELGlCQUFtQixJQUNGLEdBQUssR0FDdEJiLE9BQU9vRSxVQUFZLEdBQ1Z0RSxTQUFTK0UsaUJBQWlCLE1BQ2hDcEQsU0FBUSxTQUFBSixHQUFJLE9BQUlwQixLQUFLNkUsWUFBWXpELE1BR3hDLFNBQVMwRCxPQUNMLElBQUlDLEVBQU9uRSxpQkFBaUJBLGlCQUFpQm5CLE9BQVMsR0FBR3VGLE1BQU0sSUFDM0MsSUFBaEJELEVBQUt0RixPQUFjbUIsaUJBQWlCcUUsTUFDL0JGLEVBQUt0RixPQUFTLElBQ25CbUIsaUJBQWlCcUUsTUFDakJGLEVBQUtFLE1BQ0xyRSxpQkFBaUJxRCxLQUFLYyxFQUFLTCxLQUFLLE1BRXBDM0UsT0FBT29FLFVBQVl2RCxpQkFBaUI4RCxLQUFLLElBN0c3QzlELGlCQUFpQixHQUFLLEdBZ0h0QmhCLFFBQVFzRixpQkFBaUIsWUFBYXRDLGFBQ3RDM0MsU0FBU2lGLGlCQUFpQixZQUFhUCxPQUN2Q3pFLFFBQVFnRixpQkFBaUIsWUFBYUoiLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgYnV0dG9ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXR0b25zJylcbmNvbnN0IHJlc3VsdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHQtYW5zd2VyJylcbmNvbnN0IGxpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGlzdG9yeS1saXN0JylcbmNvbnN0IGJ0bkNsZWFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsZWFyQnV0dG9uJylcbmNvbnN0IGJ0bkJhY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmFja0J1dHRvbicpXG5cbmNvbnN0IFxuICAgIGFkZGl0aW9uID0gKHgseSkgPT4geCArIHksXG4gICAgc3Vic3RyYWN0aW9uID0gKHgseSkgPT4geCAtIHksXG4gICAgbXVsdGlwbGljYXRpb24gPSAoeCx5KSA9PiB4ICogeSxcbiAgICBkaXZpc2lvbiA9ICh4LHkpID0+IHtcbiAgICAgICAgaWYgKHkgPT09IDApIGFsZXJ0KCdEaXZpc2lvbiBieSB6ZXJvJylcbiAgICAgICAgZWxzZSByZXR1cm4geCAvIHlcbiAgICB9XG5cbmZ1bmN0aW9uIHNob3dIaXN0b3J5KGhpc3RvckNhbGMpIHtcbiAgICBoaXN0b3JDYWxjICs9ICc9JyArIGFycmF5Q2FsY3VsYXRpb25bMF1cbiAgICBsZXQgZWxlbUhpcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJylcbiAgICBsZXQgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGhpc3RvckNhbGMpXG4gICAgZWxlbUhpcy5hcHBlbmQodGV4dClcbiAgICBsaXN0LmFwcGVuZChlbGVtSGlzKVxufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVSZXN1bHQoKSB7XG4gICAgbGV0IGFyciA9IGFycmF5Q2FsY3VsYXRpb24uZmlsdGVyKGl0ZW0gPT4gaXRlbSAhPT0gXCJcIiAmJiBpdGVtICE9PSBudWxsKVxuICAgIFxuICAgIGZ1bmN0aW9uIGZpbmRCcmFrZXRzKCkge1xuICAgICAgICBsZXQgaW5kZXhCZWdpbiA9IC0xXG4gICAgICAgIGxldCBpbmRleEVuZCA9IC0xXG4gICAgICAgIGFyci5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgaWYgKGl0ZW0gPT09ICcoJykgaW5kZXhCZWdpbiA9IGluZGV4XG4gICAgICAgIH0pXG4gICAgICAgIGluZGV4RW5kID0gYXJyLmluZGV4T2YoJyknLCBpbmRleEJlZ2luKVxuICAgICAgICByZXR1cm4ge2JlZ2luOiBpbmRleEJlZ2luLCBlbmQ6IGluZGV4RW5kfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNhbGN1bGF0aW9uKGFycikge1xuICAgICAgICBsZXQgZmlyc3ROdW0gPSArYXJyWzBdXG4gICAgICAgIGxldCBvcGVyYW5kID0gYXJyWzFdXG4gICAgICAgIGxldCBzZWNvbmROdW0gPSArYXJyWzJdXG4gICAgICAgIGxldCByZXN1bHRcbiAgICAgICAgXG4gICAgICAgIHN3aXRjaCAob3BlcmFuZCkge1xuICAgICAgICAgICAgY2FzZSAnKyc6XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gYWRkaXRpb24oZmlyc3ROdW0sIHNlY29uZE51bSlcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY2FzZSAnLSc6XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gc3Vic3RyYWN0aW9uKGZpcnN0TnVtLCBzZWNvbmROdW0pXG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJyonOlxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IG11bHRpcGxpY2F0aW9uKGZpcnN0TnVtLCBzZWNvbmROdW0pXG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJy8nOlxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGRpdmlzaW9uKGZpcnN0TnVtLCBzZWNvbmROdW0pXG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ9Cd0LXQuNC30LLQtdC90YHRgtCy0YvQuSDQvtC/0LXRgNCw0L3QtCcsIG9wZXJhbmQpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0LnRvU3RyaW5nKClcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBmaW5kT3BlcmFuZChhcnJDYWxjKSB7XG4gICAgICAgIGxldCBtdWx0ID0gYXJyQ2FsYy5pbmRleE9mKCcqJylcbiAgICAgICAgbGV0IGRpdiA9IGFyckNhbGMuaW5kZXhPZignLycpXG4gICAgICAgIGxldCBhZGQgPSBhcnJDYWxjLmluZGV4T2YoJysnKVxuICAgICAgICBsZXQgc3ViID0gYXJyQ2FsYy5pbmRleE9mKCctJylcblxuICAgICAgICBpZiAobXVsdCAhPT0gLTEgJiYgZGl2ICE9PSAtMSAmJiBtdWx0IDwgZGl2KSByZXR1cm4gbXVsdFxuICAgICAgICBlbHNlIGlmIChtdWx0ICE9PSAtMSAmJiBkaXYgIT09IC0xICYmIGRpdiA8IG11bHQpIHJldHVybiBkaXZcbiAgICAgICAgZWxzZSBpZiAobXVsdCAhPT0gLTEpIHJldHVybiBtdWx0XG4gICAgICAgIGVsc2UgaWYgKGRpdiAhPT0gLTEpIHJldHVybiBkaXZcblxuICAgICAgICBlbHNlIGlmIChhZGQgIT09IC0xICYmIHN1YiAhPT0gLTEgJiYgYWRkIDwgc3ViKSByZXR1cm4gYWRkXG4gICAgICAgIGVsc2UgaWYgKGFkZCAhPT0gLTEgJiYgc3ViICE9PSAtMSAmJiBzdWIgPCBhZGQpIHJldHVybiBzdWIgXG4gICAgICAgIGVsc2UgaWYgKGFkZCAhPT0gLTEpIHJldHVybiBhZGRcbiAgICAgICAgZWxzZSBpZiAoc3ViICE9PSAtMSkgcmV0dXJuIHN1YlxuICAgICAgICBlbHNlIHJldHVybiBudWxsXG4gICAgfSBcblxuICAgIGZ1bmN0aW9uIGNoYW5nZUNhbGNBcnJheShjYWxjQXJyYXksIG9wZXJhbmQpIHtcbiAgICAgICAgaWYgKG9wZXJhbmQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGxldCBuZXdBcnIgPSBjYWxjQXJyYXkuc2xpY2Uob3BlcmFuZCAtIDEsIG9wZXJhbmQgKyAyKVxuICAgICAgICAgICAgbGV0IG5ld051bVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBuZXdOdW0gPSBjYWxjdWxhdGlvbihuZXdBcnIpXG4gICAgICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbGNBcnJheS5zcGxpY2Uob3BlcmFuZCAtIDEsIDMsIG5ld051bSlcbiAgICAgICAgICAgIHJldHVybiBjYWxjQXJyYXlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGNhbGNBcnJheSlcbiAgICAgICAgfVxuICAgIH1cbiAgICBsZXQgZXhpdCA9IGZhbHNlXG4gICAgd2hpbGUgKGFyci5sZW5ndGggIT09IDEgJiYgZXhpdCAhPT0gdHJ1ZSkge1xuICAgICAgICBsZXQgYnJha2V0cyA9IGZpbmRCcmFrZXRzKClcbiAgICAgICAgaWYgKGJyYWtldHMuYmVnaW4gIT09IC0xICYmIGJyYWtldHMuZW5kICE9PSAtMSkge1xuICAgICAgICAgICAgbGV0IGRpZmYgPSBNYXRoLmFicyhicmFrZXRzLmJlZ2luIC0gYnJha2V0cy5lbmQpXG4gICAgICAgICAgICBsZXQgY2FsY0FycmF5ID0gIGRpZmYgPD0gMiA/IGFyci5zbGljZShicmFrZXRzLmJlZ2luKzEsIGJyYWtldHMuZW5kKSA6IGFyci5zbGljZShicmFrZXRzLmJlZ2luLCBicmFrZXRzLmVuZCArIDEpXG4gICAgICAgICAgICBpZiAoY2FsY0FycmF5Lmxlbmd0aCAhPT0gMSkge1xuICAgICAgICAgICAgICAgIGxldCBvcGVyYW5kID0gZmluZE9wZXJhbmQoY2FsY0FycmF5KVxuICAgICAgICAgICAgICAgIGxldCBuZXdBcnJheSA9IGNoYW5nZUNhbGNBcnJheShjYWxjQXJyYXksIG9wZXJhbmQpXG4gICAgICAgICAgICAgICAgaWYgKG5ld0FycmF5ICE9PSBmYWxzZSkgYXJyLnNwbGljZShicmFrZXRzLmJlZ2luLCBNYXRoLmFicyhicmFrZXRzLmJlZ2luIC0gYnJha2V0cy5lbmQgLSAxKSwgLi4ubmV3QXJyYXkpXG4gICAgICAgICAgICAgICAgZWxzZSBleGl0ID0gdHJ1ZVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhcnIuc3BsaWNlKGJyYWtldHMuYmVnaW4sIDEpXG4gICAgICAgICAgICAgICAgYXJyLnNwbGljZShicmFrZXRzLmVuZCAtIDEsIDEpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsZXQgb3BlcmFuZCA9IGZpbmRPcGVyYW5kKGFycilcbiAgICAgICAgICAgIGxldCBuZXdBcnIgPSBjaGFuZ2VDYWxjQXJyYXkoYXJyLCBvcGVyYW5kKVxuICAgICAgICAgICAgaWYgKG5ld0FyciAhPT0gZmFsc2UpIGFyciA9IG5ld0FyclxuICAgICAgICAgICAgZWxzZSBleGl0ID0gdHJ1ZVxuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIGFycmF5Q2FsY3VsYXRpb24gPSBbXVxuICAgIGFycmF5Q2FsY3VsYXRpb25bMF0gPSBhcnJcbn1cblxubGV0IGFycmF5Q2FsY3VsYXRpb24gPSBbXVxuYXJyYXlDYWxjdWxhdGlvblswXSA9IFwiXCJcblxuZnVuY3Rpb24gY2FsY3VsYXRpb24oZXZlbnQpIHtcbiAgICBsZXQgZWxlbWVudCA9IGV2ZW50LnRhcmdldC50ZXh0Q29udGVudFxuICAgIGxldCBub3dJbmRleCA9IGFycmF5Q2FsY3VsYXRpb24ubGVuZ3RoIC0gMSA+PSAwID8gYXJyYXlDYWxjdWxhdGlvbi5sZW5ndGggLSAxIDogMFxuICAgIGxldCBwcmV2RWxlbWVudCA9IGFycmF5Q2FsY3VsYXRpb25bbm93SW5kZXhdID09PSBcIlwiID8gYXJyYXlDYWxjdWxhdGlvbltub3dJbmRleCAtIDFdIDogYXJyYXlDYWxjdWxhdGlvbltub3dJbmRleF1cblxuICAgIGlmIChwcmV2RWxlbWVudCA9PT0gdW5kZWZpbmVkKSBwcmV2RWxlbWVudCA9IFwiXCJcblxuICAgIGZ1bmN0aW9uIGFkZEVsZW1lbnQoKSB7XG4gICAgICAgIGFycmF5Q2FsY3VsYXRpb25bbm93SW5kZXhdICs9IGVsZW1lbnRcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBuZXdFbGVtZW50KG5ld0VsZW1lbnQgPSBlbGVtZW50KSB7XG4gICAgICAgIGFycmF5Q2FsY3VsYXRpb24ucHVzaChuZXdFbGVtZW50KVxuICAgICAgICBhcnJheUNhbGN1bGF0aW9uLnB1c2goXCJcIilcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjaGVja0RvdChzdHIpIHtcbiAgICAgICAgaWYgKHN0ci5pbmNsdWRlcygnLicpKSByZXR1cm4gdHJ1ZVxuICAgICAgICBlbHNlIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIHN3aXRjaCAoZWxlbWVudCkge1xuICAgICAgICBjYXNlICcuJzpcbiAgICAgICAgICAgIGlmIChhcnJheUNhbGN1bGF0aW9uW25vd0luZGV4XSA9PT0gXCJcIikgZWxlbWVudCA9IFwiMC5cIlxuICAgICAgICAgICAgaWYoIWNoZWNrRG90KGFycmF5Q2FsY3VsYXRpb25bbm93SW5kZXhdKSkgYWRkRWxlbWVudCgpXG4gICAgICAgICAgICBicmVha1xuXG4gICAgICAgIGNhc2UgJz0nOlxuICAgICAgICAgICAgY2FsY3VsYXRlUmVzdWx0KClcbiAgICAgICAgICAgIHNob3dIaXN0b3J5KHJlc3VsdC5pbm5lclRleHQpXG4gICAgICAgICAgICBicmVha1xuXG4gICAgICAgIGNhc2UgJygpJzpcbiAgICAgICAgICAgIGxldCBjb3VudExlZnRCcmFrZXRzID0gYXJyYXlDYWxjdWxhdGlvbi5maWx0ZXIoaXRlbSA9PiBpdGVtID09PSAnKCcpLmxlbmd0aFxuICAgICAgICAgICAgbGV0IGNvdW50UmlndGhCcmFrZXRzID0gYXJyYXlDYWxjdWxhdGlvbi5maWx0ZXIoaXRlbSA9PiBpdGVtID09PSAnKScpLmxlbmd0aFxuXG4gICAgICAgICAgICBpZiAoZWxlbWVudCA9PT0gJygnKSBjb3VudExlZnRCcmFrZXRzKytcbiAgICAgICAgICAgIGlmIChlbGVtZW50ID09PSAnKScpIGNvdW50UmlndGhCcmFrZXRzKytcblxuICAgICAgICAgICAgaWYgKHByZXZFbGVtZW50ID09PSAnKScgJiYgY291bnRSaWd0aEJyYWtldHMgPT09IGNvdW50TGVmdEJyYWtldHMpIHtcbiAgICAgICAgICAgICAgICBhcnJheUNhbGN1bGF0aW9uLnB1c2goJyonKVxuICAgICAgICAgICAgICAgIGVsZW1lbnQgPScoJ1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwcmV2RWxlbWVudC5tYXRjaCgvWzAtOV0vKSAmJiBjb3VudExlZnRCcmFrZXRzID4gY291bnRSaWd0aEJyYWtldHMgfHwgcHJldkVsZW1lbnQgPT09ICcpJykge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQgPSAnKSdcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocHJldkVsZW1lbnQubWF0Y2goL1swLTldLykpIHtcbiAgICAgICAgICAgICAgICBhcnJheUNhbGN1bGF0aW9uLnB1c2goJyonKVxuICAgICAgICAgICAgICAgIGVsZW1lbnQgPSAnKCdcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudCA9ICcoJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmV3RWxlbWVudCgpXG4gICAgICAgICAgICBicmVha1xuICAgIFxuICAgICAgICBjYXNlICcrLy0nOlxuICAgICAgICAgICAgbGV0IG5vd0VsZW1lbnQgPSBhcnJheUNhbGN1bGF0aW9uW25vd0luZGV4XVxuICAgICAgICAgICAgaWYgKChub3dFbGVtZW50Lm1hdGNoKC9bMC05XS8pIHx8IHt9KS5pbnB1dCkge1xuICAgICAgICAgICAgICAgIG5vd0VsZW1lbnQgPSAtbm93RWxlbWVudFxuICAgICAgICAgICAgICAgIGFycmF5Q2FsY3VsYXRpb25bbm93SW5kZXhdID0gbm93RWxlbWVudC50b1N0cmluZygpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVha1xuICAgICAgICBcbiAgICAgICAgY2FzZSAoZWxlbWVudC5tYXRjaCgvW1xcK1xcLVxcL1xcKl0vKSB8fCB7fSkuaW5wdXQ6IC8vICsgLSAqIC9cbiAgICAgICAgICAgIGlmIChub3dJbmRleCA+IDApIHtcbiAgICAgICAgICAgICAgICBsZXQgaXNPcGVyYW5kID0gKHByZXZFbGVtZW50Lm1hdGNoKC9bXFwrXFwtXFwvXFwqXSQvKSB8fCB7fSkuaW5wdXRcbiAgICAgICAgICAgICAgICBpZiAoaXNPcGVyYW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIGFycmF5Q2FsY3VsYXRpb25bbm93SW5kZXggLSAxXSA9IGVsZW1lbnRcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFpc09wZXJhbmQgJiYgbm93SW5kZXggIT09IDAgJiYgcHJldkVsZW1lbnQgIT09ICcoJykge1xuICAgICAgICAgICAgICAgICAgICBuZXdFbGVtZW50KClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgeyAgICBcbiAgICAgICAgICAgICAgICBuZXdFbGVtZW50KClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrXG5cbiAgICAgICAgY2FzZSAoZWxlbWVudC5tYXRjaCgvWzAtOV0vKSB8fCB7fSkuaW5wdXQ6IC8vINGH0LjRgdC70LBcbiAgICAgICAgICAgIGlmIChwcmV2RWxlbWVudCA9PT0gJyknKSB7XG4gICAgICAgICAgICAgICAgYXJyYXlDYWxjdWxhdGlvbltub3dJbmRleF0gPSAnKidcbiAgICAgICAgICAgICAgICBub3dJbmRleCsrXG4gICAgICAgICAgICAgICAgYXJyYXlDYWxjdWxhdGlvbi5wdXNoKFwiXCIpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhZGRFbGVtZW50KClcbiAgICAgICAgICAgIGJyZWFrXG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfQndC10L7QttC40LTQsNC90L3Ri9C5INGB0LjQvNCy0L7QuycsIGVsZW1lbnQpXG4gICAgICAgICAgICBicmVha1xuICAgIH1cbiAgICAvL2NvbnNvbGUubG9nKGFycmF5Q2FsY3VsYXRpb24sIG5vd0luZGV4KVxuICAgIHJlc3VsdC5pbm5lclRleHQgPSBhcnJheUNhbGN1bGF0aW9uLmpvaW4oJycpXG59IFxuXG5mdW5jdGlvbiBjbGVhcigpIHtcbiAgICBhcnJheUNhbGN1bGF0aW9uID0gW11cbiAgICBhcnJheUNhbGN1bGF0aW9uWzBdID0gXCJcIlxuICAgIHJlc3VsdC5pbm5lclRleHQgPSBcIlwiXG4gICAgbGV0IGxpID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnbGknKVxuICAgIGxpLmZvckVhY2goaXRlbSA9PiBsaXN0LnJlbW92ZUNoaWxkKGl0ZW0pKVxufVxuXG5mdW5jdGlvbiBiYWNrKCkge1xuICAgIGxldCBsYXN0ID0gYXJyYXlDYWxjdWxhdGlvblthcnJheUNhbGN1bGF0aW9uLmxlbmd0aCAtIDFdLnNwbGl0KCcnKVxuICAgIGlmIChsYXN0Lmxlbmd0aCA9PT0gMSkgYXJyYXlDYWxjdWxhdGlvbi5wb3AoKVxuICAgIGVsc2UgaWYgKGxhc3QubGVuZ3RoID4gMSkge1xuICAgICAgICBhcnJheUNhbGN1bGF0aW9uLnBvcCgpXG4gICAgICAgIGxhc3QucG9wKClcbiAgICAgICAgYXJyYXlDYWxjdWxhdGlvbi5wdXNoKGxhc3Quam9pbignJykpXG4gICAgfVxuICAgIHJlc3VsdC5pbm5lclRleHQgPSBhcnJheUNhbGN1bGF0aW9uLmpvaW4oJycpXG59XG5cbmJ1dHRvbnMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgY2FsY3VsYXRpb24pXG5idG5DbGVhci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBjbGVhcilcbmJ0bkJhY2suYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgYmFjaykiXX0=
